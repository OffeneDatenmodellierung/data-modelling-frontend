# Open Data Modelling Application - LLM Context

This file provides context for Large Language Models working with this codebase.

## Project Overview

A domain-centric data modelling application built with React, TypeScript, and Electron.
Creates data architectures, models, and flow diagrams entirely offline with full Git/GitHub integration.

**Version**: 3.0.0
**License**: ISC

## Technology Stack

### Frontend
- React 19 with TypeScript
- Vite 7 build system
- ReactFlow for infinite canvas
- Excalidraw 0.18 for freeform sketches
- Zustand for state management
- TanStack Query for async state
- Tailwind CSS 4 for styling
- Vitest for testing

### Desktop
- Electron for cross-platform desktop app
- Native file system access
- IPC for main/renderer communication
- simple-git for Git operations

### WASM Modules
- **data-modelling-sdk 2.3.0**: YAML parsing, validation, ODCS/ODPS/CADS format support, Knowledge Base, Decision Records, Sketches, stable YAML key ordering, workspace relationships, 150+ infrastructure types

## Key Features

1. **Data Modelling**: Conceptual, logical, physical models with crow's feet notation
2. **Domain-Centric**: Organize by business domains with systems, tables, relationships
3. **Git Integration** (v3.0.0): Full Git version control with staging, commits, branches, stash, rebase, tags, blame
4. **GitHub Integration** (v3.0.0): PRs, reviews, comments, merge with PAT and OAuth authentication
5. **Excalidraw Sketches**: Freeform diagramming with Excalidraw integration
6. **Decision Logs**: MADR-format Architecture Decision Records
7. **Knowledge Base**: Documentation articles (Guide, Tutorial, Reference, etc.)
8. **Help Panel**: Searchable in-app documentation with keyboard shortcuts (F1)
9. **Import/Export**: ODCS, SQL, AVRO, JSON Schema, Protobuf formats
10. **Offline First**: Works without backend; GitHub features require authentication

## Project Structure

```
dm/
├── frontend/                 # Main application
│   ├── src/
│   │   ├── components/       # React components
│   │   ├── services/         # Business logic
│   │   │   ├── sdk/          # WASM SDK integration (incl. sketchService)
│   │   │   ├── storage/      # File storage
│   │   │   └── platform/     # Platform abstraction
│   │   ├── stores/           # Zustand stores
│   │   ├── hooks/            # React hooks
│   │   ├── types/            # TypeScript types
│   │   └── contexts/         # React contexts
│   ├── electron/             # Electron main/preload
│   ├── tests/                # Test files
│   ├── public/wasm/          # WASM binaries
│   └── docs/                 # Documentation
├── CHANGELOG.md
├── README.md
└── TODO.md                   # Implementation tasks
```

## Important Files

### Configuration
- `vite.config.ts`: Build configuration with WASM support
- `tsconfig.json`: TypeScript configuration
- `package.json`: Dependencies and scripts

### Documentation
- `docs/SDK_BINDINGS.md`: SDK bindings

### Tests
- `tests/unit/stores/sketchStore.test.ts`: Sketch store tests (50 tests)
- `tests/unit/services/sdk/sketchService.test.ts`: Sketch service tests (37 tests)
- `tests/unit/stores/gitStore.test.ts`: Git store tests (37 tests)
- `tests/unit/stores/githubStore.test.ts`: GitHub store tests (48 tests)
- `tests/unit/components/github/`: PR review component tests (37 tests)
- `tests/unit/stores/helpStore.test.ts`: Help store tests (23 tests)
- `tests/unit/types/help.test.ts`: Help utility tests (22 tests)
- Total test count: ~780 tests

## Development Commands

```bash
cd frontend

# Development
npm run electron:dev     # Start Electron dev mode
npm run dev              # Start Vite dev server

# Testing
npm test                 # Run all tests
npm run test:coverage    # Tests with coverage
npm run type-check       # TypeScript validation

# Building
npm run build:wasm       # Build WASM SDK
npm run build            # Build frontend
npm run electron:build   # Build Electron app
```

## Code Conventions

- TypeScript strict mode enabled
- 95% test coverage requirement
- No partial implementations or TODOs
- Conventional commit messages
- ESLint + Prettier formatting

## Excalidraw Sketches (v2.5.0)

### Overview
Excalidraw integration provides freeform diagramming for architecture, dataflow, entity-relationship, sequence, flowchart, wireframe, concept, and infrastructure diagrams. Sketches are stored per domain and support linking to tables, systems, decisions, and knowledge articles.

### Types
- `sketch.ts`: Sketch interface aligned with SDK v2.1.0 sketch-schema.json
- `SketchType`: architecture, dataflow, entity-relationship, sequence, flowchart, wireframe, concept, infrastructure, other
- `SketchStatus`: draft, review, published, archived

### Components
- `ExcalidrawEditor.tsx`: Modal editor with deferred initialization
- `SketchPanel.tsx`: Two-panel layout (list + viewer/editor)
- `SketchList.tsx`: Filterable list with thumbnails
- `SketchViewer.tsx`: Read-only view mode

### Services
- `sketchService.ts`: Parse, validate, export utilities
  - `parseJSON()`: Handles SDK format (camelCase) and frontend format (snake_case)
  - `toSDKJSON()`: Export to SDK format
  - `exportToPNG()`, `exportToSVG()`: Image export via Excalidraw utilities
  - `validateSketch()`: Full sketch validation

### Store
- `sketchStore.ts`: Zustand store following existing patterns
  - CRUD operations with auto-numbering per domain
  - Linking operations: tables, systems, articles, decisions, related sketches
  - Filtering by domain, status, type, search term
  - `getNextNumber()`: Sequential numbering within domain

### Storage
- Directory: `sketches/`
- File pattern: `{workspace}_{domain}_{name}.sketch.json`
- Global sketches: `{workspace}_global_{name}.sketch.json`

## Git/GitHub Integration (v3.0.0)

### Git Features (Electron Only)
Full Git version control via `simple-git` library:
- **Repository**: Initialize, status, current branch
- **Staging**: Stage/unstage files, view diffs
- **Commits**: Create commits, view history with diffs
- **Branches**: Create, switch, delete, merge branches
- **Remotes**: Push, pull, fetch from remotes
- **Stash**: Save, apply, pop, drop stashes
- **Advanced**: Cherry-pick, rebase, tags, blame

### GitHub Features (Browser + Electron)
GitHub API integration with dual authentication:
- **PAT Auth**: Personal Access Token for individual use
- **OAuth**: GitHub App authentication for organizations
- **Pull Requests**: List, view, create, review, merge
- **Reviews**: Approve, request changes, add comments
- **Issues**: View and manage issues

### Stores
- `gitStore.ts`: Local Git operations state
- `githubStore.ts`: GitHub API state and operations
- `helpStore.ts`: Help panel state and navigation

### Components
- `components/git/`: GitPanel, CommitHistory, BranchSelector, StashList, etc.
- `components/github/`: GitHubPanel, PullRequestList, PRDetail, CreatePRDialog, etc.
- `components/help/`: HelpPanel, HelpSearch, HelpTopicList, HelpTopicViewer, etc.

### Services
- `services/git/gitService.ts`: Git operations via Electron IPC
- `services/github/githubService.ts`: GitHub REST API client
- `services/github/githubAuthService.ts`: PAT and OAuth authentication

### Help System
- Press **F1** or **Cmd+?** to open help panel
- Searchable topics with relevance scoring
- Contextual filtering by current view
- Categories: Getting Started, Git, Canvas, Tables, Keyboard Shortcuts

### PR Review Workflow (v3.0.0)
Complete pull request review workflow with inline comments:

**Components**
- `PRListPanel.tsx`: Sidebar panel for browsing and filtering PRs
- `PRFileDiffViewer.tsx`: Enhanced diff viewer with line numbers and inline comments
- `PRInlineComment.tsx`: Inline comment thread display
- `PRReviewSubmitDialog.tsx`: Review submission modal (Approve/Request Changes/Comment)
- `BranchSwitcher.tsx`: Switch between branches during review
- `BranchComparePanel.tsx`: Compare branches and view merge changes

**Store State** (githubStore.ts)
- `pendingReview`: Collects comments before submission
- `prReviewComments`: Inline code review comments
- `reviewThreads`: Threaded discussion structure
- `previousBranch`: Track branch before PR review switch
- `showPRListPanel`: Toggle PR sidebar visibility

**Selectors**
- `selectPendingComments`: Get pending review comments
- `selectPendingCommentCount`: Count pending comments
- `selectHasPendingReview`: Check if review in progress
- `selectShowPRListPanel`: PR panel visibility state

**Types** (types/github.ts)
- `PendingReviewComment`: Comment awaiting submission
- `ReviewThread`: Threaded comment structure
- `DiffLine`: Parsed diff line with type and line numbers
- `ParsedFileDiff`: Complete file diff with hunks
- `DiffHunk`: Individual diff hunk

**Workflow**
1. Open PR List Panel from toolbar
2. Select PR to view details
3. Click file to see diff
4. Click line number to add inline comment
5. Comments collected as pending until submission
6. Submit review: Approve, Request Changes, or Comment
7. Merge PR or request changes

## Common Tasks

### Adding a New React Hook
1. Create hook in `hooks/` directory
2. Use existing hooks as templates
3. Add tests in `tests/unit/hooks/`

### Modifying Electron IPC
1. Add handler in `electron/main.ts`
2. Expose in `electron/preload.ts`
3. Add types in `services/platform/electron.ts`
